<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard</title>

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css">
    <!-- icheck -->
    <link rel="stylesheet" href="/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
    <!--    -->
    <link rel="stylesheet" href="/plugins/select2/css/select2.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/css/adminlte.min.css">
    <link rel="stylesheet" href="/css/main.css">

    <script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="hold-transition sidebar-mini">

<!--<h1>Ini halaman dashboard</h1>-->
<!--<h2>Hello {{.User.username}}</h2>-->
<div id="app">
    <div class="wrapper">

        {{template "main.top_bar" . }}

        {{template "main.left_bar" . }}
        <!-- Content Wrapper. Contains page content -->
        {{ if eq .Page.Menu 0 }}
            {{template "content.home" . }}
        {{end}}
        {{ if eq .Page.Menu 7 }}
            {{template "content.board" . }}
        {{end}}
        {{ if eq .Page.Menu 8 }}
            {{template "content.setting.details" . }}
        {{end}}
        {{ if eq .Page.Menu 9 }}
            {{template "content.setting.users" . }}
        {{end}}
        <!-- /.content-wrapper -->

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
            <div class="p-3">
                <h5>Title</h5>
                <p>Sidebar content</p>
            </div>
        </aside>
        <!-- /.control-sidebar -->

        <!-- Main Footer -->
        <footer class="main-footer">
            <!-- To the right -->
            <div class="float-right d-none d-sm-inline">
                Anything you want
            </div>
            <!-- Default to the left -->
            <strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> All rights reserved.
        </footer>
    </div>
</div>
{{ if eq .Page.Menu 0 }}
<script src="/js/script.js" type="text/babel"></script>
{{end}}
<script src="/plugins/jquery/jquery.min.js"></script>
<script>
    const current = location.pathname;

    $('.nav .nav-link').each(function(){
        let $this = $(this);

        let path = window.location.href;
        if (this.href === path) {
            $this.addClass('active');
        }

    })
    // $(".nav .nav-link").on("click", function(){
    //     $(".nav").find(".active").removeClass("active");
    //     $(this).addClass("active");
    // });
    // !async function(){const t=new AbortController,a=t.signal;setInterval(async()=>{await fetch("{{.Any.Location}}",{method:"POST",signal:a}).then(a=>{401!==a.status&&400!==a.status&&500!==a.status||t.abort()}).catch(()=>{t.abort()})},3e4)}();
    const _0x2093=['5yhNFFO','1mThAPE','407165DAXSFy','157moTgTz','236689sqPqoo','/accounts/login','409031JoEkds','152060vrEULT','2433yfXvwo','catch','POST','abort','50227FMKWDd','then','status','339htCizf','89AzUMFY'];function _0x1cf6(_0x11eb8d,_0x44ae57){return _0x1cf6=function(_0x20932c,_0x1cf62d){_0x20932c=_0x20932c-0x1da;let _0xed9967=_0x2093[_0x20932c];return _0xed9967;},_0x1cf6(_0x11eb8d,_0x44ae57);}(function(_0x1c5e43,_0x4836d1){const _0x574536=_0x1cf6;while(!![]){try{const _0xb69317=parseInt(_0x574536(0x1e6))+-parseInt(_0x574536(0x1dd))*parseInt(_0x574536(0x1de))+-parseInt(_0x574536(0x1e0))*-parseInt(_0x574536(0x1e1))+-parseInt(_0x574536(0x1e2))*parseInt(_0x574536(0x1e7))+-parseInt(_0x574536(0x1e5))+parseInt(_0x574536(0x1e3))+-parseInt(_0x574536(0x1da))*-parseInt(_0x574536(0x1df));if(_0xb69317===_0x4836d1)break;else _0x1c5e43['push'](_0x1c5e43['shift']());}catch(_0x5af37b){_0x1c5e43['push'](_0x1c5e43['shift']());}}}(_0x2093,0x3724a),!async function(){const _0x351de9=new AbortController(),_0x1824e1=_0x351de9['signal'];setInterval(async()=>{const _0x40a38e=_0x1cf6;await fetch('{{.Any.Location}}',{'method':_0x40a38e(0x1e9),'signal':_0x1824e1})[_0x40a38e(0x1db)](_0x50c34b=>{const _0x16f752=_0x40a38e;0x191===_0x50c34b[_0x16f752(0x1dc)]?window['location']['href']=_0x16f752(0x1e4):0x190===_0x50c34b['status']&&_0x351de9[_0x16f752(0x1ea)]();})[_0x40a38e(0x1e8)](()=>{_0x351de9['abort']();});},0x7530);}());
</script>
{{ if eq .Page.Menu 9 }}
<script src="/plugins/select2/js/select2.min.js"></script>
<script>
    $(function () {
        //Initialize Select2 Elements
        $('.select2').select2()
    })
</script>
<script src="/plugins/moment/moment.min.js"></script>
<script src="/js/api.js"></script>
<script>
    const _0x3bfc=['8751klWnif','ListAccount','2kpQKUu','551juRQxG','379436CJCuhM','216864MXZyHS','325429InhXdM','204532xILqXk','194432UaqecY','POST','2011JQvppm','33yXMayW'];function _0x386d(_0x3b212d,_0x23b8b7){return _0x386d=function(_0x3bfc09,_0x386ded){_0x3bfc09=_0x3bfc09-0x1b7;let _0x3f49ac=_0x3bfc[_0x3bfc09];return _0x3f49ac;},_0x386d(_0x3b212d,_0x23b8b7);}(function(_0x33f81c,_0x1aa43b){const _0x4f8a0c=_0x386d;while(!![]){try{const _0x384694=parseInt(_0x4f8a0c(0x1be))+-parseInt(_0x4f8a0c(0x1bb))+parseInt(_0x4f8a0c(0x1ba))+parseInt(_0x4f8a0c(0x1c1))*parseInt(_0x4f8a0c(0x1c2))+parseInt(_0x4f8a0c(0x1bc))+-parseInt(_0x4f8a0c(0x1b8))*-parseInt(_0x4f8a0c(0x1bd))+parseInt(_0x4f8a0c(0x1b9))*-parseInt(_0x4f8a0c(0x1c0));if(_0x384694===_0x1aa43b)break;else _0x33f81c['push'](_0x33f81c['shift']());}catch(_0x4e3c5e){_0x33f81c['push'](_0x33f81c['shift']());}}}(_0x3bfc,0x4275b),async function(){const _0x2d952a=_0x386d,_0x4c820e=new Api('/accounts/setting/list?key={{.Any.Key}}',_0x2d952a(0x1bf),undefined);await _0x4c820e[_0x2d952a(0x1b7)]();}());


    // how to get the value of the clicked table row?
    // $("#user-list").on('click', (e) => {
    //     console.log($(e.target));
    // })

    $(document).ready(function(){
        const refresh_url = "/accounts/setting/list?key={{.Any.Key}}"

        // Add user
        const _form = document.getElementById("register-account");
        _form.addEventListener("submit", FormSubmitAPI);

        async function FormSubmitAPI(event) {
            try {
                const refresh_url = "/accounts/setting/list?key={{.Any.Key}}"
                const formData = $( this ).serializeArray().reduce(function(a, x) { a[x.name] = x.value; return a; }, {});
                event.preventDefault();
                const form = event.currentTarget;
                const url = form.action;

                $("#error-data").remove();
                const request = new Api(url, 'POST', formData)
                await request.formSubmit();
                await listAccount(refresh_url)

                // reset form
                $( '#register-account' ).each(function(){
                    this.reset();
                });
            } catch (e) {
                console.error(e)
            }
        }

        // Delete User
        $("#user-list").on("click", "button", function (e) {
            e.preventDefault();
            if (e.target.nodeName === 'BUTTON') {
                // console.log(e.target.nodeName)
                // console.log($(this).val())
                $("#option-modal").html(`
                  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel">Delete</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          Are you sure?
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                          <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="deleteAccount('/accounts/setting/delete?s=${$(this).val()}&key={{.Any.Key}}')">Yes</button>
                        </div>
                      </div>
                    </div>
                  </div>
        `);

                $(".modal-footer").on("click", "button", function (e) {
                    e.preventDefault();
                    if ($(this).text() === "Yes") {
                        listAccount(refresh_url).then()
                    }
                })
            }
        })

        const _formAssignRole = document.getElementById("assign-role");
        _formAssignRole.addEventListener("submit", FormAssignRole);
        async function FormAssignRole(event) {
            event.preventDefault();
            const form = event.currentTarget;
            const url = form.action;

            const userID = $('#opt-select-user option').filter(':selected').val()
            const role = $('#opt-select-role option').filter(':selected').val()
            const permission = $('#opt-select-permission option').filter(':selected').val()
            console.log(role)
            await createRole(url, {
                userID: userID,
                role: role,
                permission: permission
            }, '{{.Any.Key}}')
        }
    })


</script>
{{end}}
<script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/js/adminlte.min.js"></script>
</body>
</html>